function result = transefficiency(mpc,disnode,node_idx)
%TRANSEFFICIENCY 此处显示有关此函数的摘要
%   此处显示详细说明
define_constants;
if nargin == 2
    node_idx = mpc.bus(:,1);         
end
connectionBus = mpc.branch(:,[1,2,4]);%得到初始连接情况和电抗值；
N = length(node_idx);%节点个数
value = zeros(N);%初始化邻接矩阵
%节点破坏后的连接情况
for j = 1:length(disnode)
    id = connectionBus(:,1) == disnode(j)|connectionBus(:,2) == disnode(j)|connectionBus(:,3) == disnode(j);
    connectionBus(id,:) = [];

%求最短距离并计算网络平均效率；
    for i = 1:length(connectionBus) %求带电抗权重的邻接矩阵
        a = connectionBus(i,:);
        value(a(1),a(2)) = a(3);
    end
    value = value + value';%得到电抗权重矩阵；  
    value = tril(value);
    value = sparse(value);
    dist = graphallshortestpaths(value,'directed',false);%得到所有节点对之间的最短路径；
    Ldist = tril(dist);%下三角矩阵
    d = 1./Ldist;
    e = find(d(:)==Inf);
    d(e)=0;
    result(j) = sum(sum(d))/(N*(N-1));


      
end

